import { Aside, BlogMarkdown, CodeEmbed, PaginatorWrapper } from '../../components'

export const meta = {
  title: 'Faceted search: From Endeca to Algolia',
}

## Faceted Search: Endeca to Algolia
[Faceted search](https://en.wikipedia.org/wiki/Faceted_search) has been powering e-commerce for decades. Endeca has been our go-to solution for over a decade but it's time to migrate to Algolia. Like with any migration, the replacement has some improvements and some feature regressions.

First let's clarify what these solutions are at a high level:

**Endeca**
- Self-host ELT infra (Endeca Forge)
- Self-host infra to serve traffic
- Windows desktop application (Endeca Developer Studio) for configuration (stored internally as XML):
  - The ELT pipline
  - Facet groups
  - Facets / Facet values
  - [Precendence Rules](https://docs.oracle.com/cd/E70265_01/config.11-3/Endecaconfig/html/gscg_precedence_rules.xmlconcept_07D2A3108D044CD38274C1BCEBBA9C4C.html) (if this facet value is selected, display these facets)
  - And more
- Write all the UI code yourself

**Algolia**
- ETL is as simple as posting to an API
- Algolia manages all infra (ETL and serving traffic), scales as needed
- Web app for configuration:
  - Configuring facets
  - [Rules](https://www.algolia.com/doc/guides/managing-results/rules/rules-overview/)
  - And more
- Provides UI libraries for all popular frameworks. You can either use the widgets out of the box and customize the CSS or use them as [headless components](https://medium.com/@nirbenyair/headless-components-in-react-and-why-i-stopped-using-ui-libraries-a8208197c268). We are using the [React Hooks library](https://www.algolia.com/doc/guides/building-search-ui/what-is-instantsearch/react-hooks/) which gives us the ability to customize the UI as much as we like.

**Missing features in Algolia**
- Limited support for pre-configured ranges (for example, Price: $100 - $200):
  - Will show ranges which have 0 results
  - Won't show how many results per range
  - No multi-select
  - _Possible workaround: Bucket items at index time and treat them like facets._
- Each sort requires a [virtual replica](https://www.algolia.com/doc/guides/managing-results/refine-results/sorting/in-depth/replicas/#what-are-virtual-replicas) of the index. Can get unwieldy to manage if you have many sorts.
- No support for facet groups (for example, group Height, Width in a Dimensions group). They must be defined in code.
  - When a facet group has no facets with data, hiding the group requires some DOM hackery.

### Issues with core offering

- Rules control things like "if I'm on refrigeration page I want to see these facets". Rules are missing critical features which have been around in Endeca for 15+ years:
  - No notion of hierarchy. If I set a rule on Refrigeration, it doesn't get applied to French Door Refrigerators by default. Has to be explicitly added.
  - No way to set a global rule like "If you select Brand, show Series". That would have to be configured in application logic/code.
  - Only one rule can be in effect for any given page. They can't be layered on each other.
    - This constraint applies even when the two rules target the exact same filter. For example, there are two types of rules (Visual/Manual) which control different _consequences_. There is no way for them to coexist. This limitation seems very arbitrary.

### Issues with frontend library (react-hooks)
- All widgets must be mounted on the DOM for app state to be maintained
  - Accordians, modals must be collapsed with CSS
- No reliable way to loop through facets and check for facets with data
- See https://github.com/algolia/instantsearch/discussions/5353 about both
- Client side transition between pages with different rules (facets to show) seems to break, requires page reload
- next/link has no native support
- Autocomplete has no native hook integration. The integration which does exist is buggy (sometimes out of sync with main app)

export default ({ children }) => <BlogMarkdown meta={meta}>{children}</BlogMarkdown>